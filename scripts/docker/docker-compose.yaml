version: '3'
networks:
  percona:
    external: false
volumes:
  percona:
    driver: local
services:
  percona:
    image: percona/percona-server@sha256:ad0f73c99b004074c2e8555c5229d247e95df8a9f7c0f0433d73bc86881f13d9 # percona/percona-server:8.0.26
    environment:
    - MYSQL_DATABASE=db
    - MYSQL_USER=nonroot
    - MYSQL_PASSWORD=nonroot
    - MYSQL_ROOT_USER=root
    - MYSQL_ROOT_PASSWORD=root
    networks:
    - percona
    ports:
    - '127.0.0.1:3306:3306'
    volumes:
    - percona:/var/lib/mysql

  server-percona-schema:
    build:
      context: ./../..
      dockerfile: ./scripts/docker/schema/Dockerfile
    environment:
    - PERCONA_DSN=mysql://root:root@tcp(percona:3306)/db
    networks:
    - percona
    depends_on:
    - percona
